name: Add Scopes To Client
before:
  - type: custom_sql
    custom_sql:
      path: client_scope_fixtures.sql
steps:
  - action: admin_api_query
    adminapi_request:
      query: |
        mutation AddScopesToClientID {
          addScopesToClientID(input: {
            clientID: "portal",
            resourceURI: "https://fixtureresource/2",
            scopes: ["resource2_scope1"]
          }) {
            scopes {
              id
              scope
              description
            }
          }
        }
      variables: "{}"
    adminapi_output:
      result: |
        {
          "data": {
            "addScopesToClientID": {
              "scopes": [
                {
                  "id": "[[string]]",
                  "scope": "resource2_scope1",
                  "description": "Resource 2 Scope 1"
                }
              ]
            }
          },
          "errors": null
        }
  - action: admin_api_query
    adminapi_request:
      query: |
        query ScopesByClient {
          resources(clientID: "portal") {
            edges {
              node {
                id
                uri
                scopes(clientID: "portal") {
                  edges {
                    node {
                      id
                      scope
                      description
                    }
                  }
                }
              }
            }
          }
        }
      variables: "{}"
    adminapi_output:
      result: |
        {
          "data": {
            "resources": {
              "edges": [
                {
                  "node": {
                    "id": "[[string]]",
                    "uri": "https://fixtureresource/2",
                    "scopes": {
                      "edges": [
                        {
                          "node": {
                            "id": "[[string]]",
                            "scope": "resource2_scope1",
                            "description": "Resource 2 Scope 1"
                          }
                        }
                      ]
                    }
                  }
                }
              ]
            }
          },
          "errors": null
        }
---
name: Add Scopes To Client - Rejected if resource is not associated
before:
  - type: custom_sql
    custom_sql:
      path: client_scope_fixtures.sql
steps:
  - action: admin_api_query
    adminapi_request:
      query: |
        mutation AddScopesToClientID {
          addScopesToClientID(input: {
            clientID: "e2e",
            resourceURI: "https://fixtureresource/2",
            scopes: ["resource2_scope1"]
          }) {
            scopes {
              id
              scope
              description
            }
          }
        }
      variables: "{}"
    adminapi_output:
      result: |
        {
          "data": null,
          "errors": [
            {
              "extensions": {
                "reason": "ResourceNotAssociatedWithClient"
              }
            }
          ]
        }
