name: has_primary_password is set to true in userinfo if user has password
before:
- type: user_import
  user_import: users.json
- type: create_session
  create_session:
    session_type: offline_grant
    session_id: e2e-offline-grant-1
    client_id: e2e
    token: e2eofflinegranttoken1
    access_token: e2eat1
    select_user_id_sql: |
      SELECT id FROM _auth_user u
        WHERE u.app_id = '{{ .AppID }}' AND
        u.standard_attributes ->> 'preferred_username' = 'user_with_pw';
steps:
  - action: http_request
    http_request_method: GET
    http_request_url: http://{{.AppID}}.authgeare2e.localhost:4000/oauth2/userinfo
    http_request_headers:
      Authorization: Bearer e2eat1
    http_output:
      http_status: 200
      json_body: |
        {
          "custom_attributes": {},
          "https://authgear.com/claims/user/can_reauthenticate": true,
          "https://authgear.com/claims/user/has_primary_password": true,
          "https://authgear.com/claims/user/is_anonymous": false,
          "https://authgear.com/claims/user/is_verified": false,
          "https://authgear.com/claims/user/roles": [],
          "preferred_username": "user_with_pw",
          "sub": "[[string]]"
        }
---
name: has_primary_password is set to false in userinfo if no password
before:
- type: user_import
  user_import: users.json
- type: create_session
  create_session:
    session_type: offline_grant
    session_id: e2e-offline-grant-1
    client_id: e2e
    token: e2eofflinegranttoken1
    access_token: e2eat1
    select_user_id_sql: |
      SELECT id FROM _auth_user u
        WHERE u.app_id = '{{ .AppID }}' AND
        u.standard_attributes ->> 'preferred_username' = 'user_without_pw';
steps:
  - action: http_request
    http_request_method: GET
    http_request_url: http://{{.AppID}}.authgeare2e.localhost:4000/oauth2/userinfo
    http_request_headers:
      Authorization: Bearer e2eat1
    http_output:
      http_status: 200
      json_body: |
        {
          "custom_attributes": {},
          "https://authgear.com/claims/user/can_reauthenticate": false,
          "https://authgear.com/claims/user/has_primary_password": false,
          "https://authgear.com/claims/user/is_anonymous": false,
          "https://authgear.com/claims/user/is_verified": false,
          "https://authgear.com/claims/user/roles": [],
          "preferred_username": "user_without_pw",
          "sub": "[[string]]"
        }
