{{ template "authflowv2/__page_frame.html" . }}
{{ define "page-content" }}

{{ $show_captcha := false }}
{{ if $.IsBotProtectionRequired }}
  {{ $show_captcha = true }}
{{ end }}
  <div 
    class="screen-icon-layout screen-icon-layout--compact flex-1-0-auto"
    {{ if $show_captcha }}
      {{ template "web/authflowv2/__bot_protection_controller.html" . }}
    {{ end }}
  >
    <i class="screen-icon material-icons">passkey</i>
    <header class="screen-title-description">
      <h1 class="screen-title">
        {{ template "v2-use-passkey-title" }}
      </h1>
      <p class="screen-description">
        {{ if eq $.FlowType "reauth" }}
          {{ template "v2-use-passkey-description-reauth" }}
        {{ else }}
          {{ template "v2-use-passkey-description" }}
        {{ end }}
      </p>
      {{ template "authflowv2/__alert_message.html"
        (dict
          "Type" "error"
          "Classname" "mt-4"
          "Message" (ternary (include "authflowv2/__error.html" .) nil (not (empty $.Error)))
        )
      }}
    </header>
    <footer
      class="flex flex-col gap-y-8"
      data-controller="authflow-passkey-request"
      data-authflow-passkey-request-options-value="{{ $.PasskeyRequestOptionsJSON }}"
      {{ if not $.Error }}
        data-authflow-passkey-request-auto-value="{{ $.AutoExecute }}"
      {{ end }}
      >
      {{ if $show_captcha }}
        {{ template "web/authflowv2/bot_protection_widget.html" . }}
      {{ end }}
      <button
        class="primary-btn w-full"
        type="button"
        data-action="click->authflow-passkey-request#use"
        data-authgear-event="authgear.button.use_passkey"
      >
        {{ template "v2-use-passkey-action" }}
      </button>
      <form class="hidden" method="post" novalidate>
        {{ $.CSRFField }}
        {{ if $show_captcha }}
          {{ template "web/authflowv2/bot_protection_form_input.html" . }}
        {{ end }}
        <input type="hidden" name="x_assertion_response" data-authflow-passkey-request-target="input">
        <button type="submit" class="hidden" name="x_action" value="" data-authflow-passkey-request-target="submit"></button>
      </form>
      {{ template "authflowv2/__authflow_branch.html" . }}
    </footer>
  </div>

{{ end }}
